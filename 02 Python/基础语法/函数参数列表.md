# 函数及参数列表

[TOC]

## 1、定义函数

```python
def fib(n):   
    """Print a Fibonacci series up to n."""
    a, b = 0, 1
    while a < n:
        print(a, end=' ')
        a, b = b, a+b
    print()


fib(2000)
```

函数体的第一个语句可以（可选的）是字符串文字；这个字符串文字是函数的文档字符串或 docstring。

函数的执行会引入一个用于函数局部变量的新符号表，更确切地说，**函数中所有的变量赋值都将存储在局部符号表中**。

而变量引用会：

	首先在局部符号表中查找，

	然后是外层函数的局部符号表，

	再然后是全局符号表，

	最后是内置名称的符号表。

因此，**全局变量和外层函数的变量不能在函数内部直接赋值**（除非是在 global 语句中定义的全局变量，或者是在 nonlocal 语句中定义的外层函数的变量），尽管它们可以被引用。

```python
# 外层函数的变量不能在函数内部直接赋值
def f():
    s = 2
    print(s)
    def f2():
        s = 3
        print(s)

    f2()
    print(s)

f()
# 2
# 3
# 2
```

在函数被调用时，实际参数（实参）会被引入被调用函数的本地符号表中；因此，**实参是通过 按值调用 传递的**（其中 值 始终是对象 引用，而不是对象的值）。 

当一个函数调用另外一个函数时，将会为该调用创建一个新的本地符号表。

函数定义会**将函数名称与函数对象在当前符号表中进行关联**。解释器会将该名称所指向的对象识别为用户自定义函数。**其他名称也可指向同一个函数对象并可被用来访问访函数:**

```sh
>>> fib
<function fib at 10042ed0>
>>> f = fib
>>> f(100)
0 1 1 2 3 5 8 13 21 34 55 89
```

即使没有 `return` 语句的函数也会返回一个值，它是 `None`（内置名称）。

一般来说解释器不会打印出单独的返回值 `None` ，如果你真想看到它，你可以使用 `print()`

```sh
>>>
>>> fib(0)
>>> print(fib(0))
None
```

写一个返回斐波那契数列的列表（而不是把它打印出来）的函数，非常简单:

```sh
>>>
>>> def fib2(n):  # return Fibonacci series up to n
...     """Return a list containing the Fibonacci series up to n."""
...     result = []
...     a, b = 0, 1
...     while a < n:
...         result.append(a)    # see below
...         a, b = b, a+b
...     return result
...
>>> f100 = fib2(100)    # call it
>>> f100                # write the result
[0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89]
```

`result.append(a)` 语句调用了列表对象 result 的方法 。

**方法是“属于”一个对象的函数，它被命名为 `obj.methodname` ，其中 obj 是某个对象（也可能是一个表达式），methodname 是由对象类型中定义的方法的名称**。

不同的类型可以定义不同的方法。不同类型的方法可以有相同的名称而不会引起歧义。

（可以使用 [类](https://docs.python.org/zh-cn/3.8/tutorial/classes.html#tut-classes) 定义自己的对象类型和方法）示例中的方法 `append()` 是为列表对象定义的；它会在列表的最后添加一个新的元素。在这个示例中它相当于 `result = result + [a]` ，但更高效。

## 2、函数定义的更多形式

给函数定义有可变数目的参数。

### 2.1、参数默认值

**对一个或多个参数指定一个默认值**。这样创建的函数，可以用比定义时允许的更少的参数调用，比如:

```python
def ask_ok(prompt, retries=4, reminder='Please try again!'):
    while True:
        ok = input(prompt)
        if ok in ('y', 'ye', 'yes'):
            return True
        if ok in ('n', 'no', 'nop', 'nope'):
            return False
        retries = retries - 1
        if retries < 0:
            raise ValueError('invalid user response')
        print(reminder)
```

这个函数可以通过几种方式调用:

- 只给出必需的参数：ask_ok('Do you really want to quit?')

- 给出一个可选的参数：ask_ok('OK to overwrite the file?', 2)

- 或者给出所有的参数：ask_ok('OK to overwrite the file?', 2, 'Come on, only yes or no!')

**默认值是在 定义过程 中在函数定义处计算的**，所以

```python
i = 5

def f(arg=i):
    print(arg)

i = 6
f()
```

会打印 5。

重要警告： **默认值只会执行一次**。这条规则在默认值为可变对象（列表、字典以及大多数类实例）时很重要。比如，**下面的函数会存储在后续调用中传递给它的参数**:

```python
def f(a, L=[]):
    L.append(a)
    return L

print(f(1))
print(f(2))
print(f(3))
```

这将打印出

	[1]
	[1, 2]
	[1, 2, 3]

如果你**不想要在后续调用之间共享默认值**，你可以这样写这个函数:【？？？】

```python
def f(a, L=None):
    if L is None:
        L = []
    L.append(a)
    return L
```

### 2.2、关键字参数





[英文官方文档](https://docs.python.org/3.8/tutorial/controlflow.html#defining-functions)

[中文官方文档](https://docs.python.org/zh-cn/3.8/tutorial/controlflow.html#defining-functions)