# 环境搭建

## sqoop1安装

前提安装jdk和hadoop

1、下载 [sqoop](http://mirrors.shu.edu.cn/apache/sqoop/)

2、解压、重命名

3、编辑sqoop-env.sh，添加如下内容：

```sh
export HADOOP_COMMON_HOME=/usr/local/hadoop
export HADOOP_MAPRED_HOME=/usr/local/hadoop
```

4、下载配置JAVA的mysql连接器

下载 [mysql-connector-java-5.1.30-bin.jar](https://dev.mysql.com/downloads/connector/j/)，并移动到 sqoop 的 lib 目录下。

5、输入sqoop version验证

![sqoop01](https://s1.ax1x.com/2020/07/01/NTe6Z4.png)

---------------------------------------------------------------

## sqoop1.99安装

1、下载、解压、重命名

2、配置环境变量

```sh
[root@zgg conf]# cat /etc/profile
export SQOOP_HOME=/opt/sqoop-1.99.7-bin-hadoop200
export SQOOP_SERVER_EXTRA_LIB=$SQOOP_HOME/extra
export CATALINA_BASE=$SQOOP_HOME/server
export LOGDIR=$SQOOP_HOME/logs/

export PATH=.:$SQOOP_HOME/bin:$PATH

[root@zgg conf]# source /etc/profile
```

在`/opt/sqoop-1.99.7-bin-hadoop200`目录下新建`logs`目录。

3、修改Hadoop下的core-site.xml文件

```xml
<property>
  <name>hadoop.proxyuser.sqoop2.hosts</name>
  <value>*</value>
</property>
<property>
  <name>hadoop.proxyuser.sqoop2.groups</name>
  <value>*</value>
</property>
```

4、配置`conf/sqoop.properties`文件

把下面的`$HADOOP_HOME`替换为自己实际路径

	org.apache.sqoop.submission.engine.mapreduce.configuration.directory=$HADOOP_HOME/etc/hadoop 

	org.apache.sqoop.submission.engine.mapreduce.configuration.directory=/opt/hadoop-3.2.1/etc/hadoop 

将以下注释放开

	org.apache.sqoop.security.authentication.type=SIMPLE
	
	org.apache.sqoop.security.authentication.handler=org.apache.sqoop.security.authentication.SimpleAuthenticationHandler
	
	org.apache.sqoop.security.authentication.anonymous=true

将`@LOGDIR@`替换为`/opt/sqoop-1.99.7-bin-hadoop200/logs`

`BASEDIR`替换为`/opt/sqoop-1.99.7-bin-hadoop200`

5、下载 mysql JDBC Driver 到`sqoop/server/lib`下

注意版本

6、初始化

```sh
[root@zgg sqoop-1.99.7-bin-hadoop200]# bin/sqoop2-tool upgrade
Setting conf dir: /opt/sqoop-1.99.7-bin-hadoop200/bin/../conf
Sqoop home directory: /opt/sqoop-1.99.7-bin-hadoop200
Sqoop tool executor:
        Version: 1.99.7
        Revision: 435d5e61b922a32d7bce567fe5fb1a9c0d9b1bbb
        Compiled on Tue Jul 19 16:08:27 PDT 2016 by abefine
Running tool: class org.apache.sqoop.tools.tool.UpgradeTool
0    [main] INFO  org.apache.sqoop.core.PropertiesConfigurationProvider  - Starting config file poller thread
Tool class org.apache.sqoop.tools.tool.UpgradeTool has finished correctly.
```

7.启动sqoop server

```sh
[root@zgg sqoop-1.99.7-bin-hadoop200]# sqoop.sh server start 
Setting conf dir: /opt/sqoop-1.99.7-bin-hadoop200/bin/../conf
Sqoop home directory: /opt/sqoop-1.99.7-bin-hadoop200
Starting the Sqoop2 server...
0    [main] INFO  org.apache.sqoop.core.SqoopServer  - Initializing Sqoop server.
4    [main] INFO  org.apache.sqoop.core.PropertiesConfigurationProvider  - Starting config file poller thread

Sqoop2 server started.
```

8.启动交互命令

```sh
[root@zgg sqoop-1.99.7-bin-hadoop200]# sqoop2-shell 
Setting conf dir: /opt/sqoop-1.99.7-bin-hadoop200/bin/../conf
Sqoop home directory: /opt/sqoop-1.99.7-bin-hadoop200
十一月 26, 2020 10:18:35 下午 java.util.prefs.FileSystemPreferences$1 run
信息: Created user preferences directory.
Sqoop Shell: Type 'help' or '\h' for help.

sqoop:000> 
```

```sh
[root@zgg ~]# jps
11715 SqoopShell
11668 SqoopJettyServer
11785 Jps
8685 RunJar
```

9、问题

如果出现`Caused by: java.lang.SecurityException: sealing violation: package org.apache.derby.impl.jdbc.authentication is sealed`，说明需要提高sqoop的lib目录下的derby jar包版本。

出现`com.google.common.base.Preconditions.checkArgument(ZLjava/lang/String;Ljava/lang/Object;)V`，说明guava.jar也需要提高版本。