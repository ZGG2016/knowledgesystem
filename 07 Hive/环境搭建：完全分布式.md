# 环境搭建：完全分布式

[TOC]

## 1、硬件配置

采用3台虚拟机，采取服务端与客户端分离模式

节点名称 | IP地址      | 内存 | 硬盘   | 节点角色
---|:---|:---|:---|:---
node1   | 192.168.1.6 | 2GB | 10GB   | 安装服务端
node2   | 192.168.1.7 | 2GB | 10GB   | 安装客户端
node3   | 192.168.1.8 | 2GB | 10GB   | 安装 MYSQL


## 2、软件版本

软件   | 版本
---    |:---
Hadoop | 3.2.1
MySQL  | 8.0
Hive   | 3.1.2

说明：安装中，要注意版本依赖、hive-site.xml的配置、mysql中的配置。

## 3、准备工作

(1)安装 Hadoop

(2)安装 MySQL，并配置 Hive

因为 MySQL 里存的是 Hive 元数据，这里只在 node3 上存储，所以只在 node3 上安装。

[安装MYSQL](https://github.com/ZGG2016/knowledgesystem/blob/master/22%20Sql/centos7%E4%B8%8B%E5%AE%89%E8%A3%85mysql.md)

## 4、安装 Hive

### 4.1、在 node1 安装服务端

(1)下载、解压、重命名

(2)配置环境变量

```sh
[root@node1 opt]# vi /etc/profile
[root@node1 opt]# source /etc/profile
[root@node1 opt]# cat /etc/profile
# /etc/profile
...

export HIVE_HOME=/opt/hive-3.1.2
export PATH=.:$HIVE_HOME/bin:$PATH
```

(3)配置hive-env.sh

```sh
[root@node1 conf]# mv hive-env.sh.template hive-env.sh
[root@node1 conf]# vi hive-env.sh 
[root@node1 conf]# cat hive-env.sh

export HADOOP_HOME=/opt/hadoop-3.2.1
export HIVE_CONF_DIR=/opt/hive-3.1.2/conf
export HIVE_AUX_JARS_PATH=/opt/hive-3.1.2/lib
```

(4)配置hive-site.xml

```xml
<property> 
	<name>javax.jdo.option.ConnectionURL</name> 
	<value>jdbc:mysql://node3:3306/hive?useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;failOverReadOnly=false&amp;allowMultiQueries=true&amp;serverTimezone=UTC&amp;useSSL=false&amp;rewriteBatchedStatements=true</value> 
	<description>JDBC connect string for a JDBC metastore</description> 
</property>
<property> 
	<name>javax.jdo.option.ConnectionDriverName</name>
	<value>com.mysql.cj.jdbc.Driver</value> 
	<description>Driver class name for a JDBC metastore</description> 
</property>
<property> 
	<name>javax.jdo.option.ConnectionUserName</name> 
	<value>hive</value> 
	<description>username to use against metastore database</description> 
</property> 
	<property> 
	<name>javax.jdo.option.ConnectionPassword</name> 
	<value>hive</value>
	<description>password to use against metastore database</description> 
</property>
```

在`/usr/local/hive/bin`目录下新建目录/iotmp

将 `hive-site.xml` 中含有 `system:java.io.tmpdir` 的配置项的值修改 `<value>/opt/hive-3.1.2/iotmp</value>`

### 4.2、在 node2 安装客户端

(1)将 node1 上的 hive 目录复制到 node2 上：

```sh
[root@node1 opt]# scp -r hive-3.1.2/ node2:/opt/
....
```

(2)修改 `hive-site.xml` 文件：

```xml
<property>
    <name>hive.metastore.uris</name>
    <value>thrift://node1:9083</value>
    <description>Thrift URI for the remote metastore. Used by metastore client to connect to remote metastore.</description>
 </property>
```

## 5、启动

(1)先启动 Hadoop

(2)初始化

**报错`Underlying cause: java.sql.SQLNonTransientConnectionException : Could not create connection to database server. Attempted reconnect 3 times. Giving up.` 未解决**

(3)启动




参考：[https://blog.csdn.net/qq_38320702/article/details/85291707](https://blog.csdn.net/qq_38320702/article/details/85291707)